<!DOCTYPE html>
<html lang="ko" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAMS - Role Assignment</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="../css/style.css">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body class="dashboard-body app-screen-height" data-system-acronym="SAMS" data-page-title="역할 배정">
    <!-- Header (Fixed Top) -->
    <div data-include="../components/header.html"></div>

    <!-- Main Flex Container (Sidebar + Content) -->
    <div class="dashboard-main-flex">

        <!-- Sidebar -->
        <div data-include="../components/sidebar.html"></div>

        <!-- Main Content (Pushed by Sidebar) -->
        <main class="dashboard-main" id="main-content">

            <!-- Content Scroll Area -->
            <div class="dashboard-content dashboard-content-full custom-scrollbar">
                <div class="dashboard-container dashboard-container-full">

                    <!-- Split Pane Container -->
                    <div class="split-container">

                        <!-- Left Pane: Role List -->
                        <div class="split-pane-left">
                            <div class="pane-header">
                                <div class="search-panel-title-group">
                                    <i data-lucide="shield-check" class="status-card-icon text-success"></i>
                                    <span class="search-panel-title">권한 목록</span>
                                </div>
                                <!-- Registration button removed as per requirements -->
                            </div>
                            <div class="pane-content custom-scrollbar">
                                <div class="table-container">
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>권한 아이디</th>
                                                <th>권한 이름</th>
                                                <th class="text-right">배정 회원 수</th>
                                                <th class="text-center hidden-mobile-sm">생성 일시</th>
                                            </tr>
                                        </thead>
                                        <tbody id="role-list-body">
                                            <!-- Initial data or JS rendered items -->
                                            <tr class="data-table-row clickable-row" data-role-id="role_total">
                                                <td>role_total</td>
                                                <td>통합 관리자</td>
                                                <td class="td-number">6</td>
                                                <td class="td-date text-center hidden-mobile-sm">2026.01.20 14:30</td>
                                            </tr>
                                            <tr class="data-table-row clickable-row" data-role-id="role_operator">
                                                <td>role_operator</td>
                                                <td>통합 운용자</td>
                                                <td class="td-number">9</td>
                                                <td class="td-date text-center">2026.01.20 09:15</td>
                                            </tr>
                                            <tr class="data-table-row clickable-row" data-role-id="role_vcdm">
                                                <td>role_vcdm</td>
                                                <td>VCDM 운용자</td>
                                                <td class="td-number">3</td>
                                                <td class="td-date text-center">2026.01.21 16:45</td>
                                            </tr>
                                            <tr class="data-table-row clickable-row" data-role-id="role_airline">
                                                <td>role_airline</td>
                                                <td>항공사</td>
                                                <td class="td-number">6</td>
                                                <td class="td-date text-center">2026.01.21 11:20</td>
                                            </tr>
                                            <tr class="data-table-row clickable-row" data-role-id="role_vertiport">
                                                <td>role_vertiport</td>
                                                <td>버티포트 운용자</td>
                                                <td class="td-number">3</td>
                                                <td class="td-date text-center">2026.01.22 13:00</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Right Pane: User Assignment -->
                        <div class="split-pane-right" id="detail-pane">
                            <!-- Empty State -->
                            <div id="empty-state" class="empty-state">
                                <i data-lucide="users" class="empty-state-icon"></i>
                                <p class="empty-state-text">좌측 목록에서 권한을 선택하여<br>배정된 사용자를 확인하세요.</p>
                            </div>

                            <!-- Detail Content (Hidden initially) -->
                            <div id="detail-content" class="hidden h-full flex flex-col">
                                <div class="pane-header">
                                    <div class="search-panel-title-group">

                                        <i data-lucide="user-check" class="status-card-icon text-success"></i>
                                        <span class="search-panel-title">권한 별 사용자 배정 목록 - <span id="selected-role-name"
                                                class="text-success"></span></span>
                                    </div>

                                    <!-- Buttons Group -->
                                    <div class="pane-header-right">
                                        <div class="action-btn-group">
                                            <button class="btn-sm btn-secondary mobile-list-btn"
                                                onclick="closeDetailPane()">
                                                <i data-lucide="list" class="trend-icon"></i> 목록
                                            </button>
                                            <button id="btn-change-role" class="btn-sm btn-primary"
                                                onclick="changeRoleModal()" disabled>
                                                <i data-lucide="edit" class="trend-icon"></i> 권한 변경
                                            </button>
                                            <button class="btn-sm btn-primary" onclick="assignUserModal()">
                                                <i data-lucide="user-plus" class="trend-icon"></i> 사용자 추가 배정
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- User Table Content -->
                                <div class="pane-content custom-scrollbar flex-1 flex flex-col">
                                    <div class="table-container flex-1">
                                        <table class="data-table">
                                            <thead>
                                                <tr>
                                                    <th class="w-10 text-center">
                                                        <label class="perm-checkbox-group justify-center">
                                                            <input type="checkbox" id="user-select-all"
                                                                class="custom-checkbox form-checkbox">
                                                        </label>
                                                    </th>
                                                    <th>아이디</th>
                                                    <th>이름</th>
                                                    <th>소속</th>
                                                    <th>이메일</th>
                                                    <th>휴대폰 번호</th>
                                                </tr>
                                            </thead>
                                            <tbody id="user-list-body">
                                                <!-- JS Rendered -->
                                            </tbody>
                                        </table>
                                    </div>

                                    <!-- Pagination Footer -->
                                    <div class="table-footer flex-none mt-auto pt-4 border-t border-slate-700/50">
                                        <span class="pagination-info">총 <span id="total-user-count">0</span> 명</span>
                                        <div class="pagination-controls">
                                            <button class="page-btn active">1</button>
                                            <button class="page-btn">2</button>
                                            <button class="page-btn"><i data-lucide="chevron-right"
                                                    class="pagination-icon"></i></button>
                                            <select class="pagination-select pagination-select-margin">
                                                <option>20개씩 보기</option>
                                                <option>50개씩 보기</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div> <!-- End of split-container -->
                </div>
            </div>
        </main>
    </div>

    <!-- System Switcher Modal -->
    <div data-include="../components/system-switcher.html"></div>

    <!-- Delete Warning Modal (Placeholder) -->
    <div id="delete-warning-modal" class="modal-overlay">
        <div class="modal-dialog">
            <div class="modal-icon warning">
                <i data-lucide="alert-triangle" width="64" height="64" class="text-icon-warning"></i>
            </div>
            <h3 class="modal-title">삭제 불가</h3>
            <p class="modal-desc">삭제할 수 없는 항목입니다.</p>
            <div class="modal-btn-group">
                <button onclick="document.getElementById('delete-warning-modal').classList.remove('active')"
                    class="btn-modal-warning">확인</button>
            </div>
        </div>
    </div>

    <!-- Change Role Modal -->
    <div id="change-role-modal" class="modal-overlay">
        <div class="modal-dialog modal-wide">
            <div class="modal-header">
                <h3 class="modal-title-left">권한 변경</h3>
                <i data-lucide="x" class="close-icon" onclick="closeChangeRoleModal()"></i>
            </div>

            <!-- Default Content -->
            <div class="modal-content">

                <!-- Selected User List -->
                <div>
                    <h4 class="modal-section-title">선택한 사용자</h4>
                    <!-- Structure matches SAM_AS_10_01 with new scroll class -->
                    <div class="table-container modal-table-scroll custom-scrollbar">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>아이디</th>
                                    <th>이름</th>
                                    <th>소속</th>
                                </tr>
                            </thead>
                            <tbody id="modal-user-list-body" class="data-table-body">
                                <!-- JS Populated -->
                            </tbody>
                        </table>
                    </div>
                    <div class="table-footer flex-none">
                        <span class="pagination-info">총 <span id="modal-total-count">0</span> 건</span>
                    </div>
                </div>

                <!-- Role Selection -->
                <div class="modal-role-group">
                    <h4 class="modal-section-title">변경할 권한 선택</h4>
                    <div id="modal-role-list" class="modal-selection-list">
                        <!-- JS Populated Radio Buttons -->
                    </div>
                </div>

            </div>

            <!-- Buttons -->
            <div class="modal-btn-group">
                <button onclick="closeChangeRoleModal()" class="btn-secondary">취소</button>
                <button id="btn-confirm-change" onclick="confirmChangeRole()" class="btn-primary" disabled>변경</button>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="success-modal" class="modal-overlay">
        <div class="modal-dialog">
            <div class="modal-icon success">
                <i data-lucide="check-circle" width="64" height="64" class="text-icon-success"></i>
            </div>
            <h3 class="modal-title">변경 완료</h3>
            <p class="modal-desc">권한이 성공적으로 변경되었습니다.</p>
            <div class="modal-btn-group">
                <button onclick="closeSuccessModal()" class="btn-primary">확인</button>
            </div>
        </div>
    </div>

    <!-- Assign User Modal -->
    <div id="assign-user-modal" class="modal-overlay">
        <div class="modal-dialog modal-wide">
            <div class="modal-header">
                <h3 class="modal-title-left">사용자 추가 배정</h3>
                <i data-lucide="x" class="close-icon" onclick="closeAssignModal()"></i>
            </div>
            <div class="mb-standard">
                <h4 class="modal-section-title">권한</h4>
                <div class="info">
                    <span id="assign-modal-role-name" class="info-text"></span>
                    <span id="assign-modal-role-id" class="info-description"></span>
                </div>
            </div>
            <!-- MOVED: Unassigned User List Title -->
            <h4 class="modal-section-title">배정할 사용자 선택</h4>
            <div class="modal-content modal-content-stack">




                <!-- Search Filter (Collapsed by default) -->
                <div class="search-panel flex-none">
                    <div class="search-panel-header" onclick="toggleAssignModalFilter()">
                        <div class="search-panel-title-group">
                            <i data-lucide="filter" class="status-card-icon text-success"></i>
                            <span class="search-panel-title">검색 필터</span>
                        </div>
                        <i data-lucide="chevron-down" id="assign-filter-chevron" class="filter-chevron"></i>
                    </div>

                    <div id="assign-filter-content" class="search-panel-content hidden">
                        <div class="filter-panel-inner">
                            <div class="filter-grid">
                                <div>
                                    <label class="filter-label">키워드</label>
                                    <div class="filter-date-range">
                                        <select id="filter-assign-type" class="filter-select">
                                            <option value="">선택</option>
                                            <option value="id">아이디</option>
                                            <option value="name">이름</option>
                                            <option value="dept">소속</option>
                                        </select>
                                        <input type="text" id="filter-assign-keyword" class="filter-input"
                                            placeholder="키워드 입력">
                                    </div>
                                </div>
                            </div>
                            <div class="filter-actions">
                                <button class="filter-btn-common filter-btn-reset" onclick="resetAssignFilter()">
                                    <i data-lucide="rotate-ccw" class="trend-icon"></i> 초기화
                                </button>
                                <button class="filter-btn-common filter-btn-search" onclick="applyAssignFilter()">
                                    <i data-lucide="search" class="trend-icon"></i> 조회
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Unassigned User List -->
                <div>

                    <div class="table-container modal-table-scroll custom-scrollbar">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th class="w-10 text-center">
                                        <label class="perm-checkbox-group justify-center">
                                            <input type="checkbox" id="assign-user-select-all"
                                                class="custom-checkbox form-checkbox">
                                        </label>
                                    </th>
                                    <th>아이디</th>
                                    <th>이름</th>
                                    <th>소속</th>
                                </tr>
                            </thead>
                            <tbody id="assign-user-list-body" class="data-table-body">
                                <!-- JS Populated -->
                            </tbody>
                        </table>
                    </div>
                    <!-- Added Count Info -->
                    <div class="table-footer flex-none">
                        <span class="pagination-info">선택 <span id="assign-modal-selected-count"
                                class="text-teal-400">0</span> 명 / 총 <span id="assign-modal-total-count">0</span>
                            명</span>
                    </div>
                </div>

            </div>

            <!-- Buttons -->
            <div class="modal-btn-group">
                <button onclick="closeAssignUserModal()" class="btn-secondary">취소</button>
                <button id="btn-save-assign" onclick="saveAssignUser()" class="btn-primary" disabled>저장</button>
            </div>
        </div>
    </div>

    <script src="../js/include.js"></script>
    <script src="../js/common.js"></script>
    <script src="../js/SAM_AU_02_01.js"></script>
</body>

</html>